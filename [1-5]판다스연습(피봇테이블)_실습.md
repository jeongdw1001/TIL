```python
# 설정변경코드
from IPython.core.interactiveshell import InteractiveShell
InteractiveShell.ast_node_interactivity="all"
```


```python
import pandas as pd
import numpy as np
import random
import seaborn as sns
```


```python
data =  {
    "도시": ["서울", "서울", "서울", "부산", "부산", "부산", "인천", "인천"],
    "연도": ["2015", "2010", "2005", "2015", "2010", "2005", "2015", "2010"],
    "인구": [9904312, 9631482, 9762546, 3448737, 3393191, 3512547, 2890451, 263203],
    "지역": ["수도권", "수도권", "수도권", "경상권", "경상권", "경상권", "수도권", "수도권"] 
}
columns =  ["도시", "연도", "인구", "지역"] 
df1 = pd.DataFrame(data, columns= columns)
```


```python
df1
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>도시</th>
      <th>연도</th>
      <th>인구</th>
      <th>지역</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>서울</td>
      <td>2015</td>
      <td>9904312</td>
      <td>수도권</td>
    </tr>
    <tr>
      <th>1</th>
      <td>서울</td>
      <td>2010</td>
      <td>9631482</td>
      <td>수도권</td>
    </tr>
    <tr>
      <th>2</th>
      <td>서울</td>
      <td>2005</td>
      <td>9762546</td>
      <td>수도권</td>
    </tr>
    <tr>
      <th>3</th>
      <td>부산</td>
      <td>2015</td>
      <td>3448737</td>
      <td>경상권</td>
    </tr>
    <tr>
      <th>4</th>
      <td>부산</td>
      <td>2010</td>
      <td>3393191</td>
      <td>경상권</td>
    </tr>
    <tr>
      <th>5</th>
      <td>부산</td>
      <td>2005</td>
      <td>3512547</td>
      <td>경상권</td>
    </tr>
    <tr>
      <th>6</th>
      <td>인천</td>
      <td>2015</td>
      <td>2890451</td>
      <td>수도권</td>
    </tr>
    <tr>
      <th>7</th>
      <td>인천</td>
      <td>2010</td>
      <td>263203</td>
      <td>수도권</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 각 도시에 대한 연도별 인구 평균
df1.pivot_table(index="도시",columns="연도",values="인구")
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>연도</th>
      <th>2005</th>
      <th>2010</th>
      <th>2015</th>
    </tr>
    <tr>
      <th>도시</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>부산</th>
      <td>3512547.0</td>
      <td>3393191.0</td>
      <td>3448737.0</td>
    </tr>
    <tr>
      <th>서울</th>
      <td>9762546.0</td>
      <td>9631482.0</td>
      <td>9904312.0</td>
    </tr>
    <tr>
      <th>인천</th>
      <td>NaN</td>
      <td>263203.0</td>
      <td>2890451.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 각 지역별 도시에 대한 연도별 인구 평균
df1.pivot_table(index=["지역","도시"],columns="연도",values="인구")
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>연도</th>
      <th>2005</th>
      <th>2010</th>
      <th>2015</th>
    </tr>
    <tr>
      <th>지역</th>
      <th>도시</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>경상권</th>
      <th>부산</th>
      <td>3512547.0</td>
      <td>3393191.0</td>
      <td>3448737.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">수도권</th>
      <th>서울</th>
      <td>9762546.0</td>
      <td>9631482.0</td>
      <td>9904312.0</td>
    </tr>
    <tr>
      <th>인천</th>
      <td>NaN</td>
      <td>263203.0</td>
      <td>2890451.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
df1 = sns.load_dataset('titanic')
df1.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>survived</th>
      <th>pclass</th>
      <th>sex</th>
      <th>age</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>fare</th>
      <th>embarked</th>
      <th>class</th>
      <th>who</th>
      <th>adult_male</th>
      <th>deck</th>
      <th>embark_town</th>
      <th>alive</th>
      <th>alone</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>3</td>
      <td>male</td>
      <td>22.0</td>
      <td>1</td>
      <td>0</td>
      <td>7.2500</td>
      <td>S</td>
      <td>Third</td>
      <td>man</td>
      <td>True</td>
      <td>NaN</td>
      <td>Southampton</td>
      <td>no</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>female</td>
      <td>38.0</td>
      <td>1</td>
      <td>0</td>
      <td>71.2833</td>
      <td>C</td>
      <td>First</td>
      <td>woman</td>
      <td>False</td>
      <td>C</td>
      <td>Cherbourg</td>
      <td>yes</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>3</td>
      <td>female</td>
      <td>26.0</td>
      <td>0</td>
      <td>0</td>
      <td>7.9250</td>
      <td>S</td>
      <td>Third</td>
      <td>woman</td>
      <td>False</td>
      <td>NaN</td>
      <td>Southampton</td>
      <td>yes</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
      <td>female</td>
      <td>35.0</td>
      <td>1</td>
      <td>0</td>
      <td>53.1000</td>
      <td>S</td>
      <td>First</td>
      <td>woman</td>
      <td>False</td>
      <td>C</td>
      <td>Southampton</td>
      <td>yes</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>3</td>
      <td>male</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>8.0500</td>
      <td>S</td>
      <td>Third</td>
      <td>man</td>
      <td>True</td>
      <td>NaN</td>
      <td>Southampton</td>
      <td>no</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>




```python
df = sns.load_dataset('titanic')[['age','sex','class','fare','survived']]
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>sex</th>
      <th>class</th>
      <th>fare</th>
      <th>survived</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>22.0</td>
      <td>male</td>
      <td>Third</td>
      <td>7.2500</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>38.0</td>
      <td>female</td>
      <td>First</td>
      <td>71.2833</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>26.0</td>
      <td>female</td>
      <td>Third</td>
      <td>7.9250</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>35.0</td>
      <td>female</td>
      <td>First</td>
      <td>53.1000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>35.0</td>
      <td>male</td>
      <td>Third</td>
      <td>8.0500</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 선실 등급별로 숙박객의 성별 평균 나이
pdf1 = pd.pivot_table(df,
              index='class',
              columns='sex',
              values='age',
              aggfunc='mean')
pdf1
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>sex</th>
      <th>female</th>
      <th>male</th>
    </tr>
    <tr>
      <th>class</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>First</th>
      <td>34.611765</td>
      <td>41.281386</td>
    </tr>
    <tr>
      <th>Second</th>
      <td>28.722973</td>
      <td>30.740707</td>
    </tr>
    <tr>
      <th>Third</th>
      <td>21.750000</td>
      <td>26.507589</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 각 선실 등급별로 숙박객의 성별에 따른 생존자 수와 생존율
pdf2 = pd.pivot_table(df,
              index='class',
              columns='sex',
              values='survived',
              aggfunc=['sum','mean'])
pdf2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">sum</th>
      <th colspan="2" halign="left">mean</th>
    </tr>
    <tr>
      <th>sex</th>
      <th>female</th>
      <th>male</th>
      <th>female</th>
      <th>male</th>
    </tr>
    <tr>
      <th>class</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>First</th>
      <td>91</td>
      <td>45</td>
      <td>0.968085</td>
      <td>0.368852</td>
    </tr>
    <tr>
      <th>Second</th>
      <td>70</td>
      <td>17</td>
      <td>0.921053</td>
      <td>0.157407</td>
    </tr>
    <tr>
      <th>Third</th>
      <td>72</td>
      <td>47</td>
      <td>0.500000</td>
      <td>0.135447</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 선실 등급별 성별에 대해 생존여부별 나이와 티켓값의 평균, 최댓값
pdf3 = pd.pivot_table(df,
              index=['class','sex'],
              columns='survived',
              values=['age','fare'],
              aggfunc=['mean','max'])
pdf3
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="4" halign="left">mean</th>
      <th colspan="4" halign="left">max</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">age</th>
      <th colspan="2" halign="left">fare</th>
      <th colspan="2" halign="left">age</th>
      <th colspan="2" halign="left">fare</th>
    </tr>
    <tr>
      <th></th>
      <th>survived</th>
      <th>0</th>
      <th>1</th>
      <th>0</th>
      <th>1</th>
      <th>0</th>
      <th>1</th>
      <th>0</th>
      <th>1</th>
    </tr>
    <tr>
      <th>class</th>
      <th>sex</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">First</th>
      <th>female</th>
      <td>25.666667</td>
      <td>34.939024</td>
      <td>110.604167</td>
      <td>105.978159</td>
      <td>50.0</td>
      <td>63.0</td>
      <td>151.55</td>
      <td>512.3292</td>
    </tr>
    <tr>
      <th>male</th>
      <td>44.581967</td>
      <td>36.248000</td>
      <td>62.894910</td>
      <td>74.637320</td>
      <td>71.0</td>
      <td>80.0</td>
      <td>263.00</td>
      <td>512.3292</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Second</th>
      <th>female</th>
      <td>36.000000</td>
      <td>28.080882</td>
      <td>18.250000</td>
      <td>22.288989</td>
      <td>57.0</td>
      <td>55.0</td>
      <td>26.00</td>
      <td>65.0000</td>
    </tr>
    <tr>
      <th>male</th>
      <td>33.369048</td>
      <td>16.022000</td>
      <td>19.488965</td>
      <td>21.095100</td>
      <td>70.0</td>
      <td>62.0</td>
      <td>73.50</td>
      <td>39.0000</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Third</th>
      <th>female</th>
      <td>23.818182</td>
      <td>19.329787</td>
      <td>19.773093</td>
      <td>12.464526</td>
      <td>48.0</td>
      <td>63.0</td>
      <td>69.55</td>
      <td>31.3875</td>
    </tr>
    <tr>
      <th>male</th>
      <td>27.255814</td>
      <td>22.274211</td>
      <td>12.204469</td>
      <td>15.579696</td>
      <td>74.0</td>
      <td>45.0</td>
      <td>69.55</td>
      <td>56.4958</td>
    </tr>
  </tbody>
</table>
</div>



## 그룹 분석
- 만약  키가  지정하는  조건에  맞는  데이터가  하나  이상이라서  데이터  그룹을  이루는  경우에는  그룹의  특성을 보여주는  그룹분석(group analysis)을  해야  함.
    - 그룹 분석은  피벗테이블과  달리  키에  의해서  결정되는  데이터가  여러개가  있을  경우  미리  지정한  연산을 통해  그  그룹  데이터의  대표값을  계산  하는  것
- 판다스에서는 groupby 메서드를  사용하여  아래  내용  처럼  그룹분석을  진행
    - 분석하고자  하는  시리즈나  데이터프레임에 groupby 메서드를  호출하여  그룹화  수행 
    - 그룹  객체에  대해  그룹연산을  수행
    
### groupby 메서드
- groupby 메서드는  데이터를  그룹  별로  분류하는  역할을  함 
- groupby 메서드의  인수
    - 열  또는  열의  리스트 
    - 행  인덱스
- 연산  결과로  그룹  데이터를  나타내는 GroupBy 클래스  객체를  반환 
    - 이  객체에는  그룹별로  연산을  할  수  있는  그룹연산  메서드가  있음

### GroupBy 클래스  객체의  그룹연산  메서드

- size, count: 그룹  데이터의  갯수
- mean, median, min, max: 그룹  데이터의  평균, 중앙값, 최소, 최대
- sum, prod, std, var, quantile : 그룹  데이터의  합계, 곱, 표준편차, 분산, 사분위수 
- first, last: 그룹  데이터  중  가장  첫번째  데이터와  가장  나중  데이터

### 이  외에도  많이  사용되는  그룹  연산

- agg, aggregate
    - 만약  원하는  그룹연산이  없는  경우  함수를  만들고  이  함수를 agg에  전달한다.
    - 또는  여러가지  그룹연산을  동시에  하고  싶은  경우  함수  이름  문자열의  리스트를  전달한다. 
- describe
    - 하나의  그룹  대표값이  아니라  여러개의  값을  데이터프레임으로  구한다. 
- apply
    - describe 처럼  하나의  대표값이  아닌  데이터프레임을  출력하지만  원하는  그룹연산이  없는  경우에  사용한다.
- transform
    - 그룹에  대한  대표값을  만드는  것이  아니라  그룹별  계산을  통해  데이터  자체를  변형한다.


```python
np.random.seed(0) 
df2 =    pd.DataFrame({
'key1': ['A', 'A', 'B', 'B', 'A'],
'key2': ['one', 'two', 'one', 'two', 'one'], 
'data1': [1, 2, 3, 4, 5],
'data2': [10, 20, 30, 40, 50] 
})
df2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key1</th>
      <th>key2</th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>one</td>
      <td>1</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A</td>
      <td>two</td>
      <td>2</td>
      <td>20</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B</td>
      <td>one</td>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B</td>
      <td>two</td>
      <td>4</td>
      <td>40</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A</td>
      <td>one</td>
      <td>5</td>
      <td>50</td>
    </tr>
  </tbody>
</table>
</div>




```python
groups = df2.groupby(df2.key1)
groups
```




    <pandas.core.groupby.generic.DataFrameGroupBy object at 0x00000200BEC97B20>




```python
# groups 속성을 확인하면 그룹핑된 요약을 볼 수 있음
groups.groups
# 딕셔너리 반환
# {그룹명 : 그룹에 포함된 행인덱스}
groups.groups.keys() 
groups.groups['A']
```




    {'A': [0, 1, 4], 'B': [2, 3]}






    dict_keys(['A', 'B'])






    Int64Index([0, 1, 4], dtype='int64')




```python
pd.DataFrame(groups)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>key1 key2  data1  data2
0    A  one      1  ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>key1 key2  data1  data2
2    B  one      3  ...</td>
    </tr>
  </tbody>
</table>
</div>




```python
pd.DataFrame(groups).loc[0].values
```




    array(['A',   key1 key2  data1  data2
                0    A  one      1     10
                1    A  two      2     20
                4    A  one      5     50], dtype=object)




```python
pd.DataFrame(groups).loc[1].values
```




    array(['B',   key1 key2  data1  data2
                2    B  one      3     30
                3    B  two      4     40], dtype=object)




```python
pd.DataFrame(groups).loc[1].values[1]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key1</th>
      <th>key2</th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>B</td>
      <td>one</td>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B</td>
      <td>two</td>
      <td>4</td>
      <td>40</td>
    </tr>
  </tbody>
</table>
</div>




```python
# groupby 객체에 연산 메서드를 적용시켜 요약 결과를 확인
groups.sum()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
      <th>data2</th>
    </tr>
    <tr>
      <th>key1</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>8</td>
      <td>80</td>
    </tr>
    <tr>
      <th>B</th>
      <td>7</td>
      <td>70</td>
    </tr>
  </tbody>
</table>
</div>




```python
groups['data1'].sum() # data1 선택 후 계산
groups.sum()['data1'] # 전체 데이터 계산 후 data1 선택
```




    key1
    A    8
    B    7
    Name: data1, dtype: int64






    key1
    A    8
    B    7
    Name: data1, dtype: int64




```python
groups['data1'].sum()
groups['data2'].sum()
```




    key1
    A    8
    B    7
    Name: data1, dtype: int64






    key1
    A    80
    B    70
    Name: data2, dtype: int64



### 그룹  함수  예제

- apply()/agg()
    - DF 등에 벡터라이징 연산을 적용하는 함수(axis = 0/1 이용하여 행/열 적용가능) 
    - agg 함수는 숫자 타입의 스칼라만 리턴하는 함수를 적용
       - apply의 특수한 경우
    - 스칼라 : 하나의 수치(數値)만으로 완전히 표시되는 양. 방향의 구별이 없는 물리적 수량임. 질량·에너지·밀도(密度)·전기량(電氣量) 따위.


```python
import seaborn as sns
iris = sns.load_dataset("iris")
```


```python
iris
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
      <th>species</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>145</th>
      <td>6.7</td>
      <td>3.0</td>
      <td>5.2</td>
      <td>2.3</td>
      <td>virginica</td>
    </tr>
    <tr>
      <th>146</th>
      <td>6.3</td>
      <td>2.5</td>
      <td>5.0</td>
      <td>1.9</td>
      <td>virginica</td>
    </tr>
    <tr>
      <th>147</th>
      <td>6.5</td>
      <td>3.0</td>
      <td>5.2</td>
      <td>2.0</td>
      <td>virginica</td>
    </tr>
    <tr>
      <th>148</th>
      <td>6.2</td>
      <td>3.4</td>
      <td>5.4</td>
      <td>2.3</td>
      <td>virginica</td>
    </tr>
    <tr>
      <th>149</th>
      <td>5.9</td>
      <td>3.0</td>
      <td>5.1</td>
      <td>1.8</td>
      <td>virginica</td>
    </tr>
  </tbody>
</table>
<p>150 rows × 5 columns</p>
</div>




```python
# iris 품종별로 그룹
i_groups = iris.groupby(iris.species)
```


```python
i_groups.mean()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>5.006</td>
      <td>3.428</td>
      <td>1.462</td>
      <td>0.246</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>5.936</td>
      <td>2.770</td>
      <td>4.260</td>
      <td>1.326</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>6.588</td>
      <td>2.974</td>
      <td>5.552</td>
      <td>2.026</td>
    </tr>
  </tbody>
</table>
</div>




```python
pd.DataFrame(i_groups)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>setosa</td>
      <td>sepal_length  sepal_width  petal_length  p...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>versicolor</td>
      <td>sepal_length  sepal_width  petal_length  p...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>virginica</td>
      <td>sepal_length  sepal_width  petal_length  ...</td>
    </tr>
  </tbody>
</table>
</div>




```python
pd.DataFrame(i_groups).loc[1].values
```




    array(['versicolor',
               sepal_length  sepal_width  petal_length  petal_width     species
           50           7.0          3.2           4.7          1.4  versicolor
           51           6.4          3.2           4.5          1.5  versicolor
           52           6.9          3.1           4.9          1.5  versicolor
           53           5.5          2.3           4.0          1.3  versicolor
           54           6.5          2.8           4.6          1.5  versicolor
           55           5.7          2.8           4.5          1.3  versicolor
           56           6.3          3.3           4.7          1.6  versicolor
           57           4.9          2.4           3.3          1.0  versicolor
           58           6.6          2.9           4.6          1.3  versicolor
           59           5.2          2.7           3.9          1.4  versicolor
           60           5.0          2.0           3.5          1.0  versicolor
           61           5.9          3.0           4.2          1.5  versicolor
           62           6.0          2.2           4.0          1.0  versicolor
           63           6.1          2.9           4.7          1.4  versicolor
           64           5.6          2.9           3.6          1.3  versicolor
           65           6.7          3.1           4.4          1.4  versicolor
           66           5.6          3.0           4.5          1.5  versicolor
           67           5.8          2.7           4.1          1.0  versicolor
           68           6.2          2.2           4.5          1.5  versicolor
           69           5.6          2.5           3.9          1.1  versicolor
           70           5.9          3.2           4.8          1.8  versicolor
           71           6.1          2.8           4.0          1.3  versicolor
           72           6.3          2.5           4.9          1.5  versicolor
           73           6.1          2.8           4.7          1.2  versicolor
           74           6.4          2.9           4.3          1.3  versicolor
           75           6.6          3.0           4.4          1.4  versicolor
           76           6.8          2.8           4.8          1.4  versicolor
           77           6.7          3.0           5.0          1.7  versicolor
           78           6.0          2.9           4.5          1.5  versicolor
           79           5.7          2.6           3.5          1.0  versicolor
           80           5.5          2.4           3.8          1.1  versicolor
           81           5.5          2.4           3.7          1.0  versicolor
           82           5.8          2.7           3.9          1.2  versicolor
           83           6.0          2.7           5.1          1.6  versicolor
           84           5.4          3.0           4.5          1.5  versicolor
           85           6.0          3.4           4.5          1.6  versicolor
           86           6.7          3.1           4.7          1.5  versicolor
           87           6.3          2.3           4.4          1.3  versicolor
           88           5.6          3.0           4.1          1.3  versicolor
           89           5.5          2.5           4.0          1.3  versicolor
           90           5.5          2.6           4.4          1.2  versicolor
           91           6.1          3.0           4.6          1.4  versicolor
           92           5.8          2.6           4.0          1.2  versicolor
           93           5.0          2.3           3.3          1.0  versicolor
           94           5.6          2.7           4.2          1.3  versicolor
           95           5.7          3.0           4.2          1.2  versicolor
           96           5.7          2.9           4.2          1.3  versicolor
           97           6.2          2.9           4.3          1.3  versicolor
           98           5.1          2.5           3.0          1.1  versicolor
           99           5.7          2.8           4.1          1.3  versicolor],
          dtype=object)




```python
pd.DataFrame(i_groups).loc[1].values[1]['sepal_width']
```




    50    3.2
    51    3.2
    52    3.1
    53    2.3
    54    2.8
    55    2.8
    56    3.3
    57    2.4
    58    2.9
    59    2.7
    60    2.0
    61    3.0
    62    2.2
    63    2.9
    64    2.9
    65    3.1
    66    3.0
    67    2.7
    68    2.2
    69    2.5
    70    3.2
    71    2.8
    72    2.5
    73    2.8
    74    2.9
    75    3.0
    76    2.8
    77    3.0
    78    2.9
    79    2.6
    80    2.4
    81    2.4
    82    2.7
    83    2.7
    84    3.0
    85    3.4
    86    3.1
    87    2.3
    88    3.0
    89    2.5
    90    2.6
    91    3.0
    92    2.6
    93    2.3
    94    2.7
    95    3.0
    96    2.9
    97    2.9
    98    2.5
    99    2.8
    Name: sepal_width, dtype: float64




```python
pd.DataFrame(i_groups).loc[1].values[1]['sepal_width'].max()
```




    3.4




```python
i_groups.petal_length.sum()
```




    species
    setosa         73.1
    versicolor    213.0
    virginica     277.6
    Name: petal_length, dtype: float64




```python
i_groups.max()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>5.8</td>
      <td>4.4</td>
      <td>1.9</td>
      <td>0.6</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>7.0</td>
      <td>3.4</td>
      <td>5.1</td>
      <td>1.8</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>7.9</td>
      <td>3.8</td>
      <td>6.9</td>
      <td>2.5</td>
    </tr>
  </tbody>
</table>
</div>




```python
i_groups.min()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>4.3</td>
      <td>2.3</td>
      <td>1.0</td>
      <td>0.1</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>4.9</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>4.9</td>
      <td>2.2</td>
      <td>4.5</td>
      <td>1.4</td>
    </tr>
  </tbody>
</table>
</div>




```python
i_groups.max()/i_groups.min() # 나누기 값
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>1.348837</td>
      <td>1.913043</td>
      <td>1.900000</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>1.428571</td>
      <td>1.700000</td>
      <td>1.700000</td>
      <td>1.800000</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>1.612245</td>
      <td>1.727273</td>
      <td>1.533333</td>
      <td>1.785714</td>
    </tr>
  </tbody>
</table>
</div>




```python
def peak_to_peak_ratio(x): # x는 시리즈
    return x.max() / x.min() 
# 함수 반환 값이 수치 스칼라 타입
```


```python
peak_to_peak_ratio(iris.sepal_length)
```




    1.8372093023255816




```python
# 그룹 객체의 각 그룹에 대해 열별로 peak_to_peak_ratio 함수 호출
i_groups.agg(peak_to_peak_ratio)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>1.348837</td>
      <td>1.913043</td>
      <td>1.900000</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>1.428571</td>
      <td>1.700000</td>
      <td>1.700000</td>
      <td>1.800000</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>1.612245</td>
      <td>1.727273</td>
      <td>1.533333</td>
      <td>1.785714</td>
    </tr>
  </tbody>
</table>
</div>




```python
def top3_petal_length(df):
    return df.sort_values(by='petal_length', ascending=False)[:3]
# 함수 반환값이 수치 집합(df가 반환됨)
```


```python
top3_petal_length(iris)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
      <th>species</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>118</th>
      <td>7.7</td>
      <td>2.6</td>
      <td>6.9</td>
      <td>2.3</td>
      <td>virginica</td>
    </tr>
    <tr>
      <th>122</th>
      <td>7.7</td>
      <td>2.8</td>
      <td>6.7</td>
      <td>2.0</td>
      <td>virginica</td>
    </tr>
    <tr>
      <th>117</th>
      <td>7.7</td>
      <td>3.8</td>
      <td>6.7</td>
      <td>2.2</td>
      <td>virginica</td>
    </tr>
  </tbody>
</table>
</div>




```python
i_groups.apply(top3_petal_length)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
      <th>species</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">setosa</th>
      <th>24</th>
      <td>4.8</td>
      <td>3.4</td>
      <td>1.9</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>44</th>
      <td>5.1</td>
      <td>3.8</td>
      <td>1.9</td>
      <td>0.4</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>23</th>
      <td>5.1</td>
      <td>3.3</td>
      <td>1.7</td>
      <td>0.5</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">versicolor</th>
      <th>83</th>
      <td>6.0</td>
      <td>2.7</td>
      <td>5.1</td>
      <td>1.6</td>
      <td>versicolor</td>
    </tr>
    <tr>
      <th>77</th>
      <td>6.7</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>1.7</td>
      <td>versicolor</td>
    </tr>
    <tr>
      <th>72</th>
      <td>6.3</td>
      <td>2.5</td>
      <td>4.9</td>
      <td>1.5</td>
      <td>versicolor</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">virginica</th>
      <th>118</th>
      <td>7.7</td>
      <td>2.6</td>
      <td>6.9</td>
      <td>2.3</td>
      <td>virginica</td>
    </tr>
    <tr>
      <th>117</th>
      <td>7.7</td>
      <td>3.8</td>
      <td>6.7</td>
      <td>2.2</td>
      <td>virginica</td>
    </tr>
    <tr>
      <th>122</th>
      <td>7.7</td>
      <td>2.8</td>
      <td>6.7</td>
      <td>2.0</td>
      <td>virginica</td>
    </tr>
  </tbody>
</table>
</div>




```python
# i_groups.agg(top3_petal_length)
# agg에 적용된 함수의 반환값이 수치 스칼라가 아니기 때문에 
# ValueError: Buffer has wrong number of dimensions (expected 1, got 2)
```


```python
def q3cut(s):
    return pd.qcut(s,3,labels=['소','중','대']).astype(str)
```


```python
iris.groupby(iris.species).petal_length.apply(q3cut)
```




    0      소
    1      소
    2      소
    3      중
    4      소
          ..
    145    소
    146    소
    147    소
    148    중
    149    소
    Name: petal_length, Length: 150, dtype: object




```python
q3cut(iris.petal_length)
```




    0      소
    1      소
    2      소
    3      소
    4      소
          ..
    145    대
    146    대
    147    대
    148    대
    149    대
    Name: petal_length, Length: 150, dtype: object




```python
iris.head(1)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
      <th>species</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
  </tbody>
</table>
</div>




```python
iris['petal_length_class']=iris.groupby(iris.species).petal_length.apply(q3cut)
iris.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
      <th>species</th>
      <th>petal_length_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>중</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
  </tbody>
</table>
</div>



## 그룹함수  및  피봇  테이블  이용  간단한  분석  예제

- 식당에서 식사 후 내는 팁(tip)과 관련된 데이터이용
    - seaborn 패키지  내 tips 데이터셋  사용

- total_bill: 식사대금 
- tip: 팁
- sex: 성별
- smoker: 흡연/금연  여부 
- day: 요일
- time: 시간 
- size: 인원


```python
tips = sns.load_dataset("tips")
tips.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_bill</th>
      <th>tip</th>
      <th>sex</th>
      <th>smoker</th>
      <th>day</th>
      <th>time</th>
      <th>size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>239</th>
      <td>29.03</td>
      <td>5.92</td>
      <td>Male</td>
      <td>No</td>
      <td>Sat</td>
      <td>Dinner</td>
      <td>3</td>
    </tr>
    <tr>
      <th>240</th>
      <td>27.18</td>
      <td>2.00</td>
      <td>Female</td>
      <td>Yes</td>
      <td>Sat</td>
      <td>Dinner</td>
      <td>2</td>
    </tr>
    <tr>
      <th>241</th>
      <td>22.67</td>
      <td>2.00</td>
      <td>Male</td>
      <td>Yes</td>
      <td>Sat</td>
      <td>Dinner</td>
      <td>2</td>
    </tr>
    <tr>
      <th>242</th>
      <td>17.82</td>
      <td>1.75</td>
      <td>Male</td>
      <td>No</td>
      <td>Sat</td>
      <td>Dinner</td>
      <td>2</td>
    </tr>
    <tr>
      <th>243</th>
      <td>18.78</td>
      <td>3.00</td>
      <td>Female</td>
      <td>No</td>
      <td>Thur</td>
      <td>Dinner</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>



- 식사  대금  대비  팁의  비율이  언제  가장  높아지는가?
    - 가공  필드  생성 : 식사대금  대비  팁의  비율 
    - tip_pt = 팁 / 식사대금


```python
tips['tip_pt']=tips['tip']/tips['total_bill']
tips.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_bill</th>
      <th>tip</th>
      <th>sex</th>
      <th>smoker</th>
      <th>day</th>
      <th>time</th>
      <th>size</th>
      <th>tip_pt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>16.99</td>
      <td>1.01</td>
      <td>Female</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>2</td>
      <td>0.059447</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10.34</td>
      <td>1.66</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>3</td>
      <td>0.160542</td>
    </tr>
    <tr>
      <th>2</th>
      <td>21.01</td>
      <td>3.50</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>3</td>
      <td>0.166587</td>
    </tr>
    <tr>
      <th>3</th>
      <td>23.68</td>
      <td>3.31</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>2</td>
      <td>0.139780</td>
    </tr>
    <tr>
      <th>4</th>
      <td>24.59</td>
      <td>3.61</td>
      <td>Female</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>4</td>
      <td>0.146808</td>
    </tr>
  </tbody>
</table>
</div>




```python
tips.info()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 244 entries, 0 to 243
    Data columns (total 8 columns):
     #   Column      Non-Null Count  Dtype   
    ---  ------      --------------  -----   
     0   total_bill  244 non-null    float64 
     1   tip         244 non-null    float64 
     2   sex         244 non-null    category
     3   smoker      244 non-null    category
     4   day         244 non-null    category
     5   time        244 non-null    category
     6   size        244 non-null    int64   
     7   tip_pt      244 non-null    float64 
    dtypes: category(4), float64(3), int64(1)
    memory usage: 9.3 KB
    


```python
tips.describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_bill</th>
      <th>tip</th>
      <th>size</th>
      <th>tip_pt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>244.000000</td>
      <td>244.000000</td>
      <td>244.000000</td>
      <td>244.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>19.785943</td>
      <td>2.998279</td>
      <td>2.569672</td>
      <td>0.160803</td>
    </tr>
    <tr>
      <th>std</th>
      <td>8.902412</td>
      <td>1.383638</td>
      <td>0.951100</td>
      <td>0.061072</td>
    </tr>
    <tr>
      <th>min</th>
      <td>3.070000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.035638</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>13.347500</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>0.129127</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>17.795000</td>
      <td>2.900000</td>
      <td>2.000000</td>
      <td>0.154770</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>24.127500</td>
      <td>3.562500</td>
      <td>3.000000</td>
      <td>0.191475</td>
    </tr>
    <tr>
      <th>max</th>
      <td>50.810000</td>
      <td>10.000000</td>
      <td>6.000000</td>
      <td>0.710345</td>
    </tr>
  </tbody>
</table>
</div>




```python
tips
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_bill</th>
      <th>tip</th>
      <th>sex</th>
      <th>smoker</th>
      <th>day</th>
      <th>time</th>
      <th>size</th>
      <th>tip_pt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>16.99</td>
      <td>1.01</td>
      <td>Female</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>2</td>
      <td>0.059447</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10.34</td>
      <td>1.66</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>3</td>
      <td>0.160542</td>
    </tr>
    <tr>
      <th>2</th>
      <td>21.01</td>
      <td>3.50</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>3</td>
      <td>0.166587</td>
    </tr>
    <tr>
      <th>3</th>
      <td>23.68</td>
      <td>3.31</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>2</td>
      <td>0.139780</td>
    </tr>
    <tr>
      <th>4</th>
      <td>24.59</td>
      <td>3.61</td>
      <td>Female</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>4</td>
      <td>0.146808</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>239</th>
      <td>29.03</td>
      <td>5.92</td>
      <td>Male</td>
      <td>No</td>
      <td>Sat</td>
      <td>Dinner</td>
      <td>3</td>
      <td>0.203927</td>
    </tr>
    <tr>
      <th>240</th>
      <td>27.18</td>
      <td>2.00</td>
      <td>Female</td>
      <td>Yes</td>
      <td>Sat</td>
      <td>Dinner</td>
      <td>2</td>
      <td>0.073584</td>
    </tr>
    <tr>
      <th>241</th>
      <td>22.67</td>
      <td>2.00</td>
      <td>Male</td>
      <td>Yes</td>
      <td>Sat</td>
      <td>Dinner</td>
      <td>2</td>
      <td>0.088222</td>
    </tr>
    <tr>
      <th>242</th>
      <td>17.82</td>
      <td>1.75</td>
      <td>Male</td>
      <td>No</td>
      <td>Sat</td>
      <td>Dinner</td>
      <td>2</td>
      <td>0.098204</td>
    </tr>
    <tr>
      <th>243</th>
      <td>18.78</td>
      <td>3.00</td>
      <td>Female</td>
      <td>No</td>
      <td>Thur</td>
      <td>Dinner</td>
      <td>2</td>
      <td>0.159744</td>
    </tr>
  </tbody>
</table>
<p>244 rows × 8 columns</p>
</div>




```python
test_df = pd.DataFrame(tips.groupby('sex'))
test_df.loc[1][1].head(2)
test_df.loc[0][1].head(2)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_bill</th>
      <th>tip</th>
      <th>sex</th>
      <th>smoker</th>
      <th>day</th>
      <th>time</th>
      <th>size</th>
      <th>tip_pt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>16.99</td>
      <td>1.01</td>
      <td>Female</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>2</td>
      <td>0.059447</td>
    </tr>
    <tr>
      <th>4</th>
      <td>24.59</td>
      <td>3.61</td>
      <td>Female</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>4</td>
      <td>0.146808</td>
    </tr>
  </tbody>
</table>
</div>






<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_bill</th>
      <th>tip</th>
      <th>sex</th>
      <th>smoker</th>
      <th>day</th>
      <th>time</th>
      <th>size</th>
      <th>tip_pt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>10.34</td>
      <td>1.66</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>3</td>
      <td>0.160542</td>
    </tr>
    <tr>
      <th>2</th>
      <td>21.01</td>
      <td>3.50</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>3</td>
      <td>0.166587</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 성별 인원수를 계산
# 모든열에 결측치가 없으므로 모든열의 성별 인원수는 동일 
tips.groupby('sex').count()
tips.groupby('sex').size() # 그룹내의 원소의 개수를 반환
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_bill</th>
      <th>tip</th>
      <th>smoker</th>
      <th>day</th>
      <th>time</th>
      <th>size</th>
      <th>tip_pt</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Male</th>
      <td>157</td>
      <td>157</td>
      <td>157</td>
      <td>157</td>
      <td>157</td>
      <td>157</td>
      <td>157</td>
    </tr>
    <tr>
      <th>Female</th>
      <td>87</td>
      <td>87</td>
      <td>87</td>
      <td>87</td>
      <td>87</td>
      <td>87</td>
      <td>87</td>
    </tr>
  </tbody>
</table>
</div>






    sex
    Male      157
    Female     87
    dtype: int64




```python
# 흡연 유무에 따른 성별 인원
t_gp =    tips.groupby(['sex','smoker']) 
# pd.DataFrame(t_gp).loc[3][1]
t_gp.size()
# 남성 여성 모두 비 흡연자수가 많다
```




    sex     smoker
    Male    Yes       60
            No        97
    Female  Yes       33
            No        54
    dtype: int64




```python
# 흡연 유무에 따른 성별 인원을 피봇테이블로 구현
tips.pivot_table('total_bill',index= 'sex',columns= 'smoker',aggfunc= 'count')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>smoker</th>
      <th>Yes</th>
      <th>No</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Male</th>
      <td>60</td>
      <td>97</td>
    </tr>
    <tr>
      <th>Female</th>
      <td>33</td>
      <td>54</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 성별 팁 비율의 평균
tips.groupby('sex')['tip_pt'].mean()
# 여성이 식사금액  대비 팁 비율의 평균이 근소하게 높다
```




    sex
    Male      0.157651
    Female    0.166491
    Name: tip_pt, dtype: float64




```python
# 흡연 유무에 따른 팁 비율의 평균
tips.groupby('smoker')['tip_pt'].mean()
# 흡연자가 비 흡연자에 비해 팁비율이 근소하게 높다
```




    smoker
    Yes    0.163196
    No     0.159328
    Name: tip_pt, dtype: float64




```python
# 성별과 흡연 유무에 따른 팁 비율의 평균
tips.pivot_table(values= 'tip_pt', index= 'sex',columns= 'smoker')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>smoker</th>
      <th>Yes</th>
      <th>No</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Male</th>
      <td>0.152771</td>
      <td>0.160669</td>
    </tr>
    <tr>
      <th>Female</th>
      <td>0.182150</td>
      <td>0.156921</td>
    </tr>
  </tbody>
</table>
</div>



### 여성 혹은 흡연자의 팁 비율이 조금 높고, 여성 흡연자가 팁을 많이 줌


```python
# 요일별 손님 수
tips.groupby('day').size()
```




    day
    Thur    62
    Fri     19
    Sat     87
    Sun     76
    dtype: int64




```python
len(tips)
```




    244




```python
# 요일별 여성/남성 손님 비율
tips.groupby(['day','sex']).size()/ len(tips)* 100
# 여성 손님은 목요일에 비중이 높고 주말은 남성손님의 비중이 높다
```




    day   sex   
    Thur  Male      12.295082
          Female    13.114754
    Fri   Male       4.098361
          Female     3.688525
    Sat   Male      24.180328
          Female    11.475410
    Sun   Male      23.770492
          Female     7.377049
    dtype: float64




```python
# 요일별 테이블당 평균 인원 수 
tips.groupby('day')['size'].mean()
```




    day
    Thur    2.451613
    Fri     2.105263
    Sat     2.517241
    Sun     2.842105
    Name: size, dtype: float64




```python
# 요일별 평균 팁 비율
tips.groupby('day')['tip_pt'].mean()
```




    day
    Thur    0.161276
    Fri     0.169913
    Sat     0.153152
    Sun     0.166897
    Name: tip_pt, dtype: float64




```python
# 요일별 평균 식사금액과 평균 팁
tips.groupby('day')[['total_bill','tip']].mean()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_bill</th>
      <th>tip</th>
    </tr>
    <tr>
      <th>day</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Thur</th>
      <td>17.682742</td>
      <td>2.771452</td>
    </tr>
    <tr>
      <th>Fri</th>
      <td>17.151579</td>
      <td>2.734737</td>
    </tr>
    <tr>
      <th>Sat</th>
      <td>20.441379</td>
      <td>2.993103</td>
    </tr>
    <tr>
      <th>Sun</th>
      <td>21.410000</td>
      <td>3.255132</td>
    </tr>
  </tbody>
</table>
</div>




```python
tips.groupby(['day','sex','smoker'])['tip_pt'].mean()
```




    day   sex     smoker
    Thur  Male    Yes       0.164417
                  No        0.165706
          Female  Yes       0.163073
                  No        0.155971
    Fri   Male    Yes       0.144730
                  No        0.138005
          Female  Yes       0.209129
                  No        0.165296
    Sat   Male    Yes       0.139067
                  No        0.162132
          Female  Yes       0.163817
                  No        0.147993
    Sun   Male    Yes       0.173964
                  No        0.158291
          Female  Yes       0.237075
                  No        0.165710
    Name: tip_pt, dtype: float64




```python
# 평균 통계량만 확인 했으므로 다른 통계값도 확인 
tips.groupby(['sex','smoker'])[['tip_pt']].describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="8" halign="left">tip_pt</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>sex</th>
      <th>smoker</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">Male</th>
      <th>Yes</th>
      <td>60.0</td>
      <td>0.152771</td>
      <td>0.090588</td>
      <td>0.035638</td>
      <td>0.101845</td>
      <td>0.141015</td>
      <td>0.191697</td>
      <td>0.710345</td>
    </tr>
    <tr>
      <th>No</th>
      <td>97.0</td>
      <td>0.160669</td>
      <td>0.041849</td>
      <td>0.071804</td>
      <td>0.131810</td>
      <td>0.157604</td>
      <td>0.186220</td>
      <td>0.291990</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Female</th>
      <th>Yes</th>
      <td>33.0</td>
      <td>0.182150</td>
      <td>0.071595</td>
      <td>0.056433</td>
      <td>0.152439</td>
      <td>0.173913</td>
      <td>0.198216</td>
      <td>0.416667</td>
    </tr>
    <tr>
      <th>No</th>
      <td>54.0</td>
      <td>0.156921</td>
      <td>0.036421</td>
      <td>0.056797</td>
      <td>0.139708</td>
      <td>0.149691</td>
      <td>0.181630</td>
      <td>0.252672</td>
    </tr>
  </tbody>
</table>
</div>


